import { createClient } from '@supabase/supabase-js';
import dotenv from 'dotenv';

dotenv.config();

const supabase = createClient(
  process.env.VITE_SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.VITE_SUPABASE_ANON_KEY
);

async function executeMigration() {
  console.log('üîß Ex√©cution de la migration show_address...\n');

  try {
    // Ajouter la colonne show_address avec DEFAULT TRUE
    const { data, error } = await supabase.rpc('exec_sql', {
      sql_query: `
        ALTER TABLE businesses
        ADD COLUMN IF NOT EXISTS show_address BOOLEAN DEFAULT TRUE;

        CREATE INDEX IF NOT EXISTS idx_businesses_show_address
        ON businesses(show_address);
      `
    });

    if (error) {
      console.error('‚ùå Erreur lors de la migration:', error);
      console.log('\n‚ö†Ô∏è  Veuillez ex√©cuter cette migration manuellement dans Supabase SQL Editor:');
      console.log('\nALTER TABLE businesses ADD COLUMN IF NOT EXISTS show_address BOOLEAN DEFAULT TRUE;');
      console.log('CREATE INDEX IF NOT EXISTS idx_businesses_show_address ON businesses(show_address);');
      return;
    }

    console.log('‚úÖ Migration ex√©cut√©e avec succ√®s!');
    console.log('La colonne show_address a √©t√© ajout√©e avec succ√®s.');

  } catch (error) {
    console.error('‚ùå Erreur:', error);
    console.log('\n‚ö†Ô∏è  Veuillez ex√©cuter cette migration manuellement dans Supabase SQL Editor:');
    console.log('\nALTER TABLE businesses ADD COLUMN IF NOT EXISTS show_address BOOLEAN DEFAULT TRUE;');
    console.log('CREATE INDEX IF NOT EXISTS idx_businesses_show_address ON businesses(show_address);');
  }
}

executeMigration();
